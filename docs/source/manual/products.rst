********
Products
********


Sky maps
========

'*.cts.gz*' file
^^^^^^^^^^^^^^^^
Counts maps are generated by the procedure AG_ctsmapgen embedded into Agilpy.

AG_ctsmapgen reads the event files listed in the event file index (see "AGILE data" section), bins the counts between tmin
and tmax, and outputs a FITS image file. The image is a two-dimensional array in the ARC or
AIT projection. The projection, size and resolution, the center and rotation of the map in Galactic coordinates, tmin, tmax, emin, and emax, along with various integration parameters (fovrad, fovradmin, albrad, phasecode) are managed by Agilepy. 

The parameters are described in the "Configuration file" section.

.. image:: ../static/analysis_product_EMIN00100_EMAX10000_01.cts.png

'*.exp.gz*' file
^^^^^^^^^^^^^^^^
Exposure maps are generated by the procedure AG_expmapgen embedded into Agilpy. 

The task AG_expmapgen reads the log files listed in the LOG index (see "AGILE data" section), integrates the exposure between tmin and tmax, and outputs a FITS exposure image file. The
image is a two-dimensional array in either the ARC or AIT projection. The projection, size and
resolution, and center and rotation of the map in Galactic coordinates, tmin, tmax, emin,
emax, and index file are managed by Agilepy, along with various integration parameters (fovrad, albrad, y tol, roll tol, earth tol, phasecode), and an interpolation step size (binstep).
The interpolation procedure is a linear interpolation method in which only one bin each N
is calculated (where N is the step size parameter). For a bin size of 0.5 deg or 0.25 deg with a
step size of N = 4 it is possible to get a good approximation of the exposure map.

The parameters are described in the "Configuration file" section.

.. image:: ../static/analysis_product_EMIN00100_EMAX10000_01.exp.png

'*.gas.gz*' file
^^^^^^^^^^^^^^^^
Diffuse emission maps are generated by the procedure AG_gasmapgen embedded into Agilpy. AG_gasmapgen reads an exposure map produced by AG_expmapgen and the master diffuse emission map and outputs a FITS image file, in the same format as the
exposure map, in which each pixel contains the diffuse emission in that pixel. The image is a
square array in the ARC projection.
The diffuse emission map
contain models of the diffuse emission convolved with the energy-dependent point spread function and combined into predefined observed energy ranges according to the appropriate energy
dispersion function for G events using the FM3.119 background filter.
The diffuse emission map automatically selected by Agilepy based on the energy range of the analysis; e.g. if the
analysis is performed between 100 MeV and 50 GeV, Agilepy select the file 100_50000.0.1.SFMG_H0025.conv.sky.gz. 
The first number in the file name is the minimum energy and the second number is the maximum energy, followed by the resolution of the maps (0.1), the background event rejection filter (FM3.119) and the instrument response functions (IRFs).

.. image:: ../static/analysis_product_EMIN00100_EMAX10000_01.gas.png

'*.int.gz*' file
^^^^^^^^^^^^^^^^
Intensity maps are generated by the procedure AG_intmapgen embedded into Agilepy. AG_intmapgen reads an exposure map produced by AG_expmapgen
and a counts map produced by AG_ctsmapgen and outputs a FITS image file, in the same format as the counts map, in which each pixel contains the intensity in that pixel. The image is
a square array in the ARC projection. The two input maps should have been produced using
the same set of parameters. The intensity map is not used in scientific analysis; it is useful
solely as a visualization tool.

.. image:: ../static/analysis_product_EMIN00100_EMAX10000_01.int.png

Light curves
============
The light curve file contains the results of the generation of a light curve. The columns are the following:

    - time start (MJD)
    - time end (MJD)
    - sqrt(ts): the square root of the Test Statistic value of the results of the maximum likelihood estimator (mle)
    - flux (ph/cm2/s/sr)
    - flux_err (ph/cm2/s/sr)
    - flux_ul (ph/cm2/s/sr)
    - the value of the galactic diffuse emission (gal) parameter
    - the value of the isotropic emission (iso) parameter
    - position in Galactic coordinate (l_peak, b_peak): peak coordinates 
    - position in Galactic coordinate (l, b): evaluated by mle with the determination of the 95% confidence level elliptical confidence region
    - Radius (r) of 95% c.l. circular confidence region, deg. Statistical error only
    - ell_dist: the distance between (l,b) and the initial position
    - time start (UTC)
    - time end (UTC) 
    - time start (TT)
    - time end (TT)

::

    time_start_mjd time_end_mjd sqrt(ts) flux flux_err flux_ul gal iso l_peak b_peak dist l b r ell_dist time_start_utc time_end_utc time_start_tt time_end_tt
    58026.49921296296 58027.49921296296 7.34802 944.077e-08 213.086e-08 1418.53e-08 0.7,0.7 4.08416,3.84041 263.647 -2.8547 0.0 -1.0 -1.0 -1.0 -1.0 2017-09-30T11:58:52 2017-10-01T11:58:52 433857532.0 433943932.0
    58027.49921296296 58028.49921296296 8.88107 1054.87e-08 211.633e-08 1523.64e-08 0.7,0.7 4.08416,3.84041 263.647 -2.8547 0.0 -1.0 -1.0 -1.0 -1.0 2017-10-01T11:58:52 2017-10-02T11:58:52 433943932.0 434030332.0
    58028.49921296296 58029.49921296296 7.31826 820.89e-08 198.193e-08 1266.73e-08 0.7,0.7 4.08416,3.84041 263.647 -2.8547 0.0 -1.0 -1.0 -1.0 -1.0 2017-10-02T11:58:52 2017-10-03T11:58:52 434030332.0 434116732.0
    58029.49921296296 58030.49921296296 6.7938 840.137e-08 208.073e-08 1306.49e-08 0.7,0.7 4.08416,3.84041 263.647 -2.8547 0.0 -1.0 -1.0 -1.0 -1.0 2017-10-03T11:58:52 2017-10-04T11:58:52 434116732.0 434203132.0
    58030.49921296296 58031.49921296296 7.62835 820.045e-08 190.836e-08 1249.26e-08 0.7,0.7 4.08416,3.84041 263.647 -2.8547 0.0 -1.0 -1.0 -1.0 -1.0 2017-10-04T11:58:52 2017-10-05T11:58:52 434203132.0 434289532.0


Data files
==========

*'.maplist4'* file
^^^^^^^^^^^^^^^^^^

Each line contains a set of maps:

.. code-block::

    <countsMap> <exposureMap> <gasMap> <offaxisangle> <galcoeff> <isocoeff>

where:

 * countsMap, exposureMap and gasMap are file system paths pointing to the corresponding sky maps (see SkyMaps section)   
 * offaxisangle is in degrees;
 * galcoeff and isocoeff are the coefficients for the galactic and isotropic diffuse components. If positive they will be considered fixed (but see galmode and isomode section).


'*.source*' file
^^^^^^^^^^^^^^^^
The .source file is an internal technical file produced by the maximum likelihood estimator mle() procedure. It contains all the analysis results for each source that is part of the ensemble of models. Agilepy extract from this .source file the most important parameters useful for the final user.